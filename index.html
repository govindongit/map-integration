<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Map Integration</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        width: 90vw;
        height: 90vh;
        text-align: center;
      }
    </style>
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
  </head>

  <body>
    <div style="text-align: center">
      <div id="map"></div>
    </div>

    <script>
      // Initialize map with center and zoom
      var map = L.map("map", {
        minZoom: 3,
        maxZoom: 19,
        worldCopyJump: true, // allow horizontal scrolling wrap
      }).setView([20.5937, 78.9629], 4); // Centered on India

      // Add OpenStreetMap layer
      L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution:
          '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      }).addTo(map);

      // Limit map bounds (prevent moving beyond world edges vertically)
      var southWest = L.latLng(-85, -180),
        northEast = L.latLng(85, 180);
      var bounds = L.latLngBounds(southWest, northEast);
      map.setMaxBounds(bounds);
      map.on("drag", function () {
        map.panInsideBounds(bounds, { animate: false });
      });

      // Define marker data
      var locations = [
        { name: "Delhi", coords: [28.61, 77.21] },
        { name: "Mumbai", coords: [19.08, 72.88] },
        { name: "Chennai", coords: [13.08, 80.27] },
        { name: "Bengaluru", coords: [12.97, 77.59] },
        { name: "Kolkata", coords: [22.33, 88.25] },
      ];

      // Create markers and store them for click checking
      var markers = [];
      locations.forEach((loc) => {
        var marker = L.marker(loc.coords)
          .addTo(map)
          .bindPopup("<b>We are available in " + loc.name + "</b>");
        markers.push(marker);
      });

      var popup = L.popup();

      // Handle clicks only when not on a marker
      map.on("click", function (e) {
        var clickedOnMarker = false;

        markers.forEach((marker) => {
          var markerLatLng = marker.getLatLng();
          var distance = e.latlng.distanceTo(markerLatLng);
          if (distance < 50000) {
            // 50km radius tolerance
            clickedOnMarker = true;
          }
        });

        if (!clickedOnMarker) {
          popup
            .setLatLng(e.latlng)
            .setContent(
              "Currently, we are not available here...<br>We will be available soon."
            )
            .openOn(map);
        }
      });
    </script>
  </body>
</html>
